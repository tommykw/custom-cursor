<!DOCTYPE html>
<html>
<head>
    <title>Eye Tracking Test</title>
    <style>
        body {
            width: 800px;
            height: 600px;
            margin: 0;
            padding: 20px;
            font-family: sans-serif;
        }
        #loading-status {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 5px;
            text-align: center;
            font-size: 14px;
            z-index: 2147483647;
        }
        #debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 2147483646;
        }
    </style>
</head>
<body>
    <div id="loading-status">初期化中...</div>
    <div id="debug-info"></div>

    <script src="face-api.min.js"></script>
    <script src="webgazer.js"></script>
    <script>
        async function initializeTracking() {
            const statusDiv = document.getElementById('loading-status');

            try {
                // Initialize face-api.js first
                statusDiv.textContent = '顔認識モデルを読み込んでいます...';
                
                // Load face-api.js models
                const modelPath = chrome.runtime.getURL('models');
                await Promise.all([
                    faceapi.nets.tinyFaceDetector.loadFromUri(modelPath),
                    faceapi.nets.faceLandmark68Net.loadFromUri(modelPath)
                ]);
                console.log('顔認識モデルの読み込みが完了しました');

                // Initialize WebGazer
                statusDiv.textContent = '視線追跡システムを初期化中...';
                const webgazer = await window.initWebGazer();
                
                // Update status
                statusDiv.textContent = '視線追跡の初期化が完了しました';
                setTimeout(() => {
                    statusDiv.style.opacity = '0';
                    statusDiv.style.transition = 'opacity 0.5s ease';
                }, 1500);

            } catch (error) {
                console.error('初期化エラー:', error);
                statusDiv.style.color = 'red';
                statusDiv.textContent = error.message;
            }
        }

        // Wait for page load before initializing
        window.addEventListener('load', initializeTracking);
    </script>
</body>
</html>
